{% load staticfiles %}
<html ng-app="chatbot">
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <style>
        * { box-sizing: border-box; margin: 0 0 0 0; padding: 0; }
        html, body { height: 100%; overflow: hidden; }
        .wrap {
            margin: 10px 10px 10px 25%; height: 90%; width: 50%;
            display: flex; flex-direction: column;
        }
        .but_my {
            background: #004BA0;
        }
        .container {
            flex: 1 1 90%; display: flex; flex-direction: column;
            background-color: #eee; border: 1px solid #ccc; overflow: auto;
        }
        .header{
            font-family: "Courier New", Courier, "Courier 10 Pitch", monospace;
            text-align: center;
        }
        .form { flex: 0 0 32px; display: flex; border: 1px solid #ddd; }
        .form > input[type=text] { flex: 1 1 auto; border: 1px solid #eee; }
        .form > input[type=button] { flex: 0 0 20%; border: 1px solid #eee; }
        .bubble { flex: 1 1 auto; clear: both; } /* clear the floats here on parent */
        .bubble p {
            border-radius: 5px;
            padding: 8px; margin: 8px 12px;
            max-width: 80%;  /* this will make it not exceed 80% and then wrap */
            position: relative; transition: background-color 0.5s;
        }
        .left p { background-color: #ccc; float: left; } /* floated left */
        .right p { background-color: #004BA0; color: #fff; float: right; } /* floated right */
        /* classes below are only for arrows, not relevant */
        .left p::before {
            content: ''; position: absolute;
            width: 0; height: 0; left: -8px; top: 8px;
            border-top: 4px solid transparent;
            border-right: 8px solid #ccc;
            border-bottom: 4px solid transparent;
        }
        .right p::after {
            content: ''; position: absolute;
            width: 0; height: 0; right: -8px; bottom: 8px;
            border-top: 4px solid transparent;
            border-left: 8px solid #004BA0;
            border-bottom: 4px solid transparent;
        }
    </style>
</head>
<body ng-controller="MainController">
<h2 class="header">ÕIS2 CHATBOT</h2>
{%  verbatim %}
<div class="wrap">
    <div id="chatWindow" class="container">
        <div ng-repeat="question in questions" >
            <div ng-if="question[1] == 'True'">
                <div class="bubble right">
                    <p>{{ question[0]}}</p>
                </div>
            </div>
            <div ng-if="question[1]=='False'">
                <div class="bubble left">
                    <p>{{ question[0].answer }}</p>
                </div>
            </div>

        </div>
    </div>
    <form id="inputWindow" class="form">

        <input id="ifield"  type="text" ng-model="question">
        <button class="but_my btn btn-primary" id="btn" type="submit" ng-click="addItem(question)"> Küsi </button>
    </form>
</div>
</div>
{% endverbatim %}
</body>
</html>

<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular.min.js"></script>
<script></script>
<script type="text/javascript">
    function clearfield() {
    document.getElementById("ifield").value = "";
}

(function(){
        var app = angular.module("chatbot", []);

        var MainController = function($scope, $http,){
            $scope.message = "kana";
            var answer = {"answer":"Tere, mina olen ÕIS2 resources! Abi saamiseks kirjuta help"};
            $scope.questions = [];
            $scope.questions.push([answer, "False"]);

            $scope.addItem = function(question){
                clearfield();
            $scope.questions.push([question,'True']);
            var dataobject = {
                question: question
            };
             $http({
               method: 'POST',
               url: 'api/question',
               data: dataobject,
               headers: {
                   'Content-Type':  'application/json',
                   'Access-Control-Allow-Origin': 'true',
                    "X-Requested-With": "XMLHttpRequest",

               }
            }).then(function(response){
                var preanswer = response;
                var a = preanswer.toString().split("\n");
                var f = "";
                for (let l in a){
                    f +=l + "<br>"
                     }
                $scope.answer = f;

                $scope.questions.push([response.data,'False']);

            },
            function(response){
                var answer = {"answer":"Ma tõesti ei tea. "};
                $scope.questions.push([answer,'False']);
            }
            );
        };

        };
        app.controller("MainController", MainController);
    }());
</script>
